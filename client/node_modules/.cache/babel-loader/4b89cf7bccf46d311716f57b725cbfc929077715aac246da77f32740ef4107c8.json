{"ast":null,"code":"import { takeLatest, call, put, all } from \"redux-saga/effects\";\nimport UserActionTypes from \"./user-types\";\nimport { signInSuccess, signInFailure, signOutSuccess, signOutFailure, signUpSuccess, signUpFailure } from \"./user-actions\";\nimport { auth, createUserProfileDocument, provider, getCurrentUser } from \"../../firebase/firebase.utils\";\nexport function getSnapShotFromUserAuth(userAuth) {\n  let additionalData = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n  return function* () {\n    try {\n      const userRef = yield call(createUserProfileDocument, userAuth, additionalData);\n      const snapShot = yield userRef.get();\n      const currentUser = {\n        id: snapShot.id,\n        ...snapShot.data()\n      };\n      if (additionalData) {\n        yield put(signUpSuccess(currentUser));\n      } else {\n        yield put(signInSuccess(currentUser));\n      }\n    } catch (error) {\n      if (additionalData) {\n        yield put(signUpFailure(error));\n      } else {\n        yield put(signInFailure(error));\n      }\n    }\n  }();\n}\nexport function* googleSignInAsync() {\n  try {\n    const {\n      user\n    } = yield auth.signInWithPopup(provider);\n    yield getSnapShotFromUserAuth(user);\n  } catch (error) {\n    yield put(signInFailure(error));\n  }\n}\nexport function* onGoogleSignInStart() {\n  yield takeLatest(UserActionTypes.GOOGLE_SIGN_IN_START, googleSignInAsync);\n}\nexport function* signOutCurrentUser() {\n  try {\n    yield auth.signOut();\n    yield put(signOutSuccess());\n  } catch (error) {\n    yield put(signOutFailure(error));\n  }\n}\nexport function* onSignOut() {\n  yield takeLatest(UserActionTypes.SIGNOUT_START, signOutCurrentUser);\n}\nexport function signInWithEmail(_ref) {\n  let {\n    payload: {\n      email,\n      password\n    }\n  } = _ref;\n  return function* () {\n    try {\n      const {\n        user\n      } = yield auth.signInWithEmailAndPassword(email, password);\n      yield getSnapShotFromUserAuth(user);\n    } catch (error) {\n      yield put(signInFailure(error));\n    }\n  }();\n}\nexport function* onEmailSignInStart() {\n  yield takeLatest(UserActionTypes.EMAIL_SIGN_IN_START, signInWithEmail);\n}\nexport function* isUserAuthenticated() {\n  try {\n    const userAuth = yield getCurrentUser();\n    if (!userAuth) return;\n    yield getSnapShotFromUserAuth(userAuth);\n  } catch (error) {\n    yield put(signInFailure(error));\n  }\n}\nexport function* onCheckUserSession() {\n  yield takeLatest(UserActionTypes.CHECK_USER_SESSION, isUserAuthenticated);\n}\nexport function signUpEmailPassword(_ref2) {\n  let {\n    payload: {\n      displayName,\n      email,\n      password\n    }\n  } = _ref2;\n  return function* () {\n    try {\n      const {\n        user\n      } = yield auth.createUserWithEmailAndPassword(email, password);\n      yield getSnapShotFromUserAuth(user, {\n        displayName\n      });\n    } catch (error) {\n      console.error(error);\n    }\n  }();\n}\nexport function* onSignUpStart() {\n  yield takeLatest(UserActionTypes.SIGNUP_START, signUpEmailPassword);\n}\nexport function* onSignUpSuccess() {\n  yield takeLatest(UserActionTypes.SIGNUP_SUCCESS, isUserAuthenticated);\n}\nexport function* userSagas() {\n  yield all([call(onGoogleSignInStart), call(onSignOut), call(onEmailSignInStart), call(onCheckUserSession), call(onSignUpStart), call(onSignUpSuccess)]);\n}","map":{"version":3,"names":["takeLatest","call","put","all","UserActionTypes","signInSuccess","signInFailure","signOutSuccess","signOutFailure","signUpSuccess","signUpFailure","auth","createUserProfileDocument","provider","getCurrentUser","getSnapShotFromUserAuth","userAuth","additionalData","arguments","length","undefined","userRef","snapShot","get","currentUser","id","data","error","googleSignInAsync","user","signInWithPopup","onGoogleSignInStart","GOOGLE_SIGN_IN_START","signOutCurrentUser","signOut","onSignOut","SIGNOUT_START","signInWithEmail","_ref","payload","email","password","signInWithEmailAndPassword","onEmailSignInStart","EMAIL_SIGN_IN_START","isUserAuthenticated","onCheckUserSession","CHECK_USER_SESSION","signUpEmailPassword","_ref2","displayName","createUserWithEmailAndPassword","console","onSignUpStart","SIGNUP_START","onSignUpSuccess","SIGNUP_SUCCESS","userSagas"],"sources":["/home/eli/crwn-clothing/client/src/redux/user/user.sagas.js"],"sourcesContent":["import { takeLatest, call, put, all } from \"redux-saga/effects\";\nimport UserActionTypes from \"./user-types\";\nimport {\n    signInSuccess,\n    signInFailure,\n    signOutSuccess,\n    signOutFailure,\n    signUpSuccess,\n    signUpFailure,\n} from \"./user-actions\";\n\n\nimport {auth, createUserProfileDocument, provider, getCurrentUser} from \"../../firebase/firebase.utils\";\n\nexport function* getSnapShotFromUserAuth(userAuth, additionalData = null) {\n    try {\n        const userRef = yield call(createUserProfileDocument, userAuth, additionalData);\n        const snapShot = yield userRef.get();\n        const currentUser = {\n            id: snapShot.id,\n            ...snapShot.data()\n        };\n        if(additionalData) {\n            yield put(signUpSuccess(currentUser));\n        } else {\n            yield put(signInSuccess(currentUser));\n        }\n    } catch (error) {\n        if(additionalData) {\n            yield put(signUpFailure(error));\n        } else {\n            yield put(signInFailure(error))\n        }\n    }\n}\n\nexport function* googleSignInAsync() {\n    try {\n        const { user } = yield auth.signInWithPopup(provider);\n        yield getSnapShotFromUserAuth(user);\n    } catch (error) {\n        yield put(signInFailure(error));\n    }\n}\n\nexport function* onGoogleSignInStart() {\n    yield takeLatest(\n        UserActionTypes.GOOGLE_SIGN_IN_START,\n        googleSignInAsync\n    )\n}\n\nexport function* signOutCurrentUser() {\n    try {\n        yield auth.signOut();\n        yield put(signOutSuccess());\n    } catch ( error ) {\n       yield put(signOutFailure(error));\n    }\n}\n\nexport function* onSignOut() {\n    yield takeLatest(\n        UserActionTypes.SIGNOUT_START,\n        signOutCurrentUser\n    )\n}\n\nexport function* signInWithEmail({ payload: { email, password }}) {\n    try {\n        const { user } = yield auth.signInWithEmailAndPassword(email, password);\n        yield getSnapShotFromUserAuth(user);\n    } catch (error) {\n        yield put(signInFailure(error));\n    }\n}\n\nexport function* onEmailSignInStart() {\n    yield takeLatest(UserActionTypes.EMAIL_SIGN_IN_START, signInWithEmail)\n}\n\nexport function* isUserAuthenticated() {\n    try {\n        const userAuth = yield getCurrentUser();\n        if(!userAuth) return\n        yield getSnapShotFromUserAuth(userAuth);\n    } catch (error) {\n        yield put(signInFailure(error))\n    }\n}\n\nexport function* onCheckUserSession() {\n    yield takeLatest(UserActionTypes.CHECK_USER_SESSION, isUserAuthenticated);\n}\n\n\nexport function* signUpEmailPassword({payload: {displayName, email, password}}) {\n    try {\n        const { user } = yield auth.createUserWithEmailAndPassword(email, password);\n        yield getSnapShotFromUserAuth(user, { displayName });\n    } catch(error) {\n        console.error(error);\n    }\n}\n\nexport function* onSignUpStart() {\n    yield takeLatest(UserActionTypes.SIGNUP_START, signUpEmailPassword);\n}\n\nexport function* onSignUpSuccess() {\n    yield takeLatest(UserActionTypes.SIGNUP_SUCCESS, isUserAuthenticated);\n}\n\nexport function* userSagas() {\n    yield all([\n        call(onGoogleSignInStart),\n        call(onSignOut),\n        call(onEmailSignInStart),\n        call(onCheckUserSession),\n        call(onSignUpStart),\n        call(onSignUpSuccess)\n    ])\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}